@using Piranha.Manager
@using Microsoft.AspNetCore.Authorization
@inject IAuthorizationService AuthorizationService
@{
    var controller = ViewBag.Controller?.ToLower();
    var menuindex = 0;
}

<partial name="Partial/_MenuHeader" />
<ul class="navbar-nav">
    @foreach (var group in Piranha.Manager.Menu.Items)
    {
        if (group.Items.Count > 0)
        {
            <li>
                <span class="header"><i class="@group.Css"></i>@group.Name</span>
                @if (group.Items.Count > 0)
                {
                    <ul>
                        @foreach (var item in group.Items)
                        {
                            if (string.IsNullOrWhiteSpace(item.Policy) || (await AuthorizationService.AuthorizeAsync(User, item.Policy)).Succeeded)
                            {
                                <li @(item.Controller.ToLower() == controller ? "class=active" : "")>
                                    <a href="@Url.Action(item.Action, item.Controller, item.Params)" tabindex="-1" data-index="@(menuindex++)">
                                        @if (!string.IsNullOrEmpty(item.Css)) {
                                            <i class="@item.Css"></i>
                                        }
                                        @item.Name
                                    </a>
                                </li>
                            }
                        }
                    </ul>
                }
            </li>
        }
    }
    <li><a class="header" href="@Url.Action("Logout", "Account")" tabindex="-1" data-index="@(menuindex++)"><i class="fas fa-power-off"></i>Logout</a></li>
</ul>